import{r as k,z as me,b as ge,g as pe,j as y,p as ye,w as be,A as xe,D as Se,x as we,B as Ce,y as je,G as Re,S as ke}from"./index-ih0eSx80.js";import{M as We}from"./index-gmqFlRPh.js";import{S as _e}from"./search-filter-cecALaN7.js";import"./description-8TzrVJh3.js";var Y={exports:{}};(function(p,j){(function(b,f){f(j,k)})(me,function(b,f){function S(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var G=S(f),s=function(){return s=Object.assign||function(e){for(var r,i=1,o=arguments.length;i<o;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)};function E(t,e,r){if(r||arguments.length===2)for(var i=0,o=e.length,n;i<o;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var A={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T;function D(){if(T)return W;T=1;var t=G.default,e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function u(l,a,d){var h,m={},g=null,x=null;d!==void 0&&(g=""+d),a.key!==void 0&&(g=""+a.key),a.ref!==void 0&&(x=a.ref);for(h in a)i.call(a,h)&&!n.hasOwnProperty(h)&&(m[h]=a[h]);if(l&&l.defaultProps)for(h in a=l.defaultProps,a)m[h]===void 0&&(m[h]=a[h]);return{$$typeof:e,type:l,key:g,ref:x,props:m,_owner:o.current}}return W.Fragment=r,W.jsx=u,W.jsxs=u,W}A.exports=D();var c=A.exports,N=function(t,e,r){return typeof t=="function"?t(r):typeof t=="object"?t:e(r)},U={3:"rotate(180deg)",2:"rotateY(180deg)",4:"rotate(180deg) rotateY(180deg)",5:"rotate(270deg) rotateY(180deg)",6:"rotate(90deg)",7:"rotate(90deg) rotateY(180deg)",8:"rotate(270deg)"},_=16,v={display:"flex",flexWrap:"wrap"},R=function(t){var e=t.item,r=U[e.orientation],i={cursor:"pointer",maxWidth:"none",width:e.scaledWidth,height:e.scaledHeight,marginLeft:e.marginLeft,marginTop:0,transform:r};if(e.isSelected){var o=e.scaledWidth/e.scaledHeight,n=e.scaledHeight-_*2,u=e.viewportWidth-_*2,l=void 0,a=void 0;e.scaledWidth>e.scaledHeight?(a=e.scaledWidth-_*2,l=Math.floor(a/o)):(l=e.scaledHeight-_*2,a=Math.floor(l*o));var d=Math.abs(Math.floor((n-l)/2)),h=Math.abs(Math.floor((u-a)/2));i.width=a,i.height=l,i.marginLeft=h===0?0:-h,i.marginTop=d===0?0:-d}return i},M=function(t){var e=t.item,r={width:e.viewportWidth,height:e.scaledHeight,overflow:"hidden"};return e.nano&&(r.background="url(".concat(e.nano,")"),r.backgroundSize="cover",r.backgroundPosition="center center"),e.isSelected&&(r.width=e.viewportWidth-_*2,r.height=e.scaledHeight-_*2,r.margin=_),r},F=function(t){var e=t.hover;return{pointerEvents:"none",opacity:e?1:0,position:"absolute",height:"100%",width:"100%"}},q=function(t){var e=t.margin;return{margin:e,WebkitUserSelect:"none",position:"relative",background:"#eee",padding:"0px"}},$=function(t){var e=t.showOverlay;return{pointerEvents:"none",opacity:1,position:"absolute",height:"100%",width:"100%",background:e?"linear-gradient(to bottom,rgba(0,0,0,0.26),transparent 56px,transparent)":"none"}},ee={pointerEvents:"none",opacity:1,position:"absolute",height:"36px",width:"100%"},te={background:"white",width:"100%",margin:0,userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",overflow:"hidden"},re={padding:"2px",pointerEvents:"none",position:"absolute",minHeight:"0px",maxHeight:"160px",width:"100%",bottom:"0px",overflow:"hidden"},ie={display:"inline-block",cursor:"pointer",pointerEvents:"visible",margin:"2px"},ne=function(){return{display:"inline",padding:".2em .6em .3em",fontSize:"75%",fontWeight:"600",lineHeight:"1",color:"yellow",background:"rgba(0,0,0,0.65)",textAlign:"center",whiteSpace:"nowrap",verticalAlign:"baseline",borderRadius:".25em"}},ae=function(t){var e=t.isVisible;return{visibility:e?"visible":"hidden",background:"none",float:"left",width:36,height:36,border:"none",padding:6,cursor:"pointer",pointerEvents:"visible"}},J=function(t){var e=t.isSelected,r=e===void 0?!1:e,i=t.isVisible,o=i===void 0?!0:i,n=t.onClick,u=t.color,l=u===void 0?"#FFFFFFB2":u,a=t.selectedColor,d=a===void 0?"#4285F4FF":a,h=t.hoverColor,m=h===void 0?"#FFFFFFFF":h,g=f.useState(!1),x=g[0],w=g[1],C={display:r?"block":"none"},B=r?d:x?m:l,L=function(){return w(!0)},V=function(){return w(!1)};return c.jsx("div",s({"data-testid":"grid-gallery-item_check-button",title:"Select",style:ae({isVisible:o}),onClick:n,onMouseOver:L,onMouseOut:V},{children:c.jsxs("svg",s({fill:B,height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},{children:[c.jsxs("radialGradient",s({id:"shadow",cx:"38",cy:"95.488",r:"10.488",gradientTransform:"matrix(1 0 0 -1 -26 109)",gradientUnits:"userSpaceOnUse"},{children:[c.jsx("stop",{offset:".832",stopColor:"#010101"}),c.jsx("stop",{offset:"1",stopColor:"#010101",stopOpacity:"0"})]})),c.jsx("circle",{style:C,opacity:".26",fill:"url(#shadow)",cx:"12",cy:"13.512",r:"10.488"}),c.jsx("circle",{style:C,fill:"#FFF",cx:"12",cy:"12.2",r:"8.292"}),c.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})]}))}))},oe=function(t){var e=t.item,r=t.thumbnailImageComponent,i=t.isSelectable,o=i===void 0?!0:i,n=t.thumbnailStyle,u=t.tagStyle,l=t.tileViewportStyle,a=t.margin,d=t.index,h=t.onSelect,m=t.onClick,g={item:e},x=f.useState(!1),w=x[0],C=x[1],B={key:d,"data-testid":"grid-gallery-item_thumbnail",src:e.src,alt:e.alt?e.alt:"",title:typeof e.caption=="string"?e.caption:null,style:N(n,R,g)},L=function(I){o&&h(d,I)},V=function(I){m(d,I)},P={item:e,index:d,margin:a,onSelect:h,onClick:m,isSelectable:o,tileViewportStyle:l,thumbnailStyle:n,tagStyle:u};return c.jsxs("div",s({className:"ReactGridGallery_tile","data-testid":"grid-gallery-item",onMouseEnter:function(){return C(!0)},onMouseLeave:function(){return C(!1)},style:q({margin:a})},{children:[c.jsx("div",s({className:"ReactGridGallery_tile-icon-bar",style:ee},{children:c.jsx(J,{isSelected:e.isSelected,isVisible:e.isSelected||o&&w,onClick:L})})),!!e.tags&&c.jsx("div",s({className:"ReactGridGallery_tile-bottom-bar",style:re},{children:e.tags.map(function(I,z){return c.jsx("div",s({title:I.title,style:ie},{children:c.jsx("span",s({style:N(u,ne,g)},{children:I.value}))}),I.key||z)})})),!!e.customOverlay&&c.jsx("div",s({className:"ReactGridGallery_custom-overlay",style:F({hover:w})},{children:e.customOverlay})),c.jsx("div",{className:"ReactGridGallery_tile-overlay",style:$({showOverlay:w&&!e.isSelected&&o})}),c.jsx("div",s({className:"ReactGridGallery_tile-viewport","data-testid":"grid-gallery-item_viewport",style:N(l,M,g),onClick:V},{children:r?c.jsx(r,s({},P,{imageProps:B})):c.jsx("img",s({},B))})),e.thumbnailCaption&&c.jsx("div",s({className:"ReactGridGallery_tile-description",style:te},{children:e.thumbnailCaption}))]}))};function le(t){var e=f.useRef(null),r=f.useRef(),i=f.useState(t),o=i[0],n=i[1],u=f.useCallback(function(l){var a;(a=r.current)===null||a===void 0||a.disconnect(),r.current=void 0,e.current=l;var d=function(){if(e.current){var h=e.current.clientWidth;try{h=e.current.getBoundingClientRect().width}catch{}n(Math.floor(h))}};d(),l&&typeof ResizeObserver<"u"&&(r.current=new ResizeObserver(d),r.current.observe(l))},[]);return{containerRef:u,containerWidth:o}}var se=function(t,e,r){var i=[],o=0;for(var n in t){var u=t[n],l=u.scaledWidth/e;i[n]=Math.floor(l*r),o+=i[n]}for(var a=r-o;a>0;)for(var n in i)if(i[n]++,a--,a<0)break;return i},ce=function(t,e){for(var r=e.containerWidth,i=e.rowHeight,o=e.margin,n=[],u=2*o,l=E([],t,!0),a=0;l.length>0&&a<r;){var d=l.shift(),h=Math.floor(i*(d.width/d.height)),m=s(s({},d),{scaledHeight:i,scaledWidth:h,viewportWidth:h,marginLeft:0});n.push(m),a+=m.scaledWidth+u}var g=a-r;if(n.length>0&&g>0){var x=se(n,a,g);for(var w in n){var C=x[w],d=n[w];d.marginLeft=-Math.abs(Math.floor(C/2)),d.viewportWidth=d.scaledWidth-C}}return[n,l]},K=function(t,e,r){r===void 0&&(r=[]);var i=ce(t,e),o=i[0],n=i[1],u=E(E([],r,!0),[o],!1);return e.maxRows&&u.length>=e.maxRows?u:n.length?K(n,e,u):u},Q=function(t,e){var r=e.containerWidth,i=e.maxRows,o=e.rowHeight,n=e.margin;if(o=typeof o>"u"?180:o,n=typeof n>"u"?2:n,!t)return[];if(!r)return[];var u={containerWidth:r,maxRows:i,rowHeight:o,margin:n};return K(t,u)},X=function(t,e){var r=Q(t,e);return[].concat.apply([],r)},Z=function(t){var e=t.images,r=t.id,i=r===void 0?"ReactGridGallery":r,o=t.enableImageSelection,n=o===void 0?!0:o,u=t.onSelect,l=u===void 0?function(){}:u,a=t.rowHeight,d=a===void 0?180:a,h=t.maxRows,m=t.margin,g=m===void 0?2:m,x=t.defaultContainerWidth,w=x===void 0?0:x,C=t.onClick,B=C===void 0?function(){}:C,L=t.tileViewportStyle,V=t.thumbnailStyle,P=t.tagStyle,I=t.thumbnailImageComponent,z=le(w),ue=z.containerRef,de=z.containerWidth,he=X(e,{containerWidth:de,maxRows:h,rowHeight:d,margin:g}),ve=function(O,H){H.preventDefault(),l(O,e[O],H)},fe=function(O,H){B(O,e[O],H)};return c.jsx("div",s({id:i,className:"ReactGridGallery",ref:ue},{children:c.jsx("div",s({style:v},{children:he.map(function(O,H){return c.jsx(oe,{item:O,index:H,margin:g,height:d,isSelectable:n,onClick:fe,onSelect:ve,tagStyle:P,tileViewportStyle:L,thumbnailStyle:V,thumbnailImageComponent:I},O.key||H)})}))}))};Z.displayName="Gallery",b.CheckButton=J,b.Gallery=Z,b.buildLayout=Q,b.buildLayoutFlat=X,Object.defineProperty(b,"__esModule",{value:!0})})})(Y,Y.exports);var Ie=Y.exports;const Oe=()=>{const p=ge();return{getCatalogsImages:{data:p[0],status:p[1],fetch:({search:j},b={})=>{p[2]({method:"get",url:pe({path:"/catalogs/images",query:{search:j}})},b)},reset:p[3]}}},Ge=p=>{const[j,b]=k.useState(!1),f=k.useMemo(()=>new IntersectionObserver(([S])=>b(S.isIntersecting)),[p]);return k.useEffect(()=>(f.observe(p.current),()=>f.disconnect()),[]),j},Ee=({imageProps:p})=>{const{style:j}=p,[b,f]=k.useState(!1),S=k.useRef(null),G=Ge(S);return k.useEffect(()=>{G&&f(!0)},[G]),b?y.jsx("img",{...p}):y.jsx("div",{ref:S,style:{...j},className:"flex items-center justify-center",children:y.jsx(ye,{className:"h-12 w-12"})})},Be=({onSelected:p,multi:j})=>{const{onClose:b}=be(),{getCatalogsImages:f}=Oe(),{data:S,setData:G}=xe("modal_catalogsSearchImage"),[s,E]=k.useState([]),[A,W]=k.useState();k.useEffect(()=>{S&&(W(S.search),E(S.result.map(({height:v,url:R,width:M,title:F})=>({height:v,width:M,src:R,alt:F}))))},[S]);const T=Se(),D=()=>{const v=s.filter(({isSelected:R})=>R);v.length&&(p==null||p(v.map(({src:R,height:M,width:F})=>({src:R,height:M,width:F})))),b()},c=v=>{const R=s[v];E(j?Re(s,{...R,isSelected:!R.isSelected},v):s.map((M,F)=>({...M,isSelected:F===v})))},N=v=>y.jsx("div",{className:"flex items-center justify-center w-full h-full border-gray-300 rounded-md border-2 border-dashed text-gray-400",children:v}),U=()=>f.status.isBusy?N(y.jsx(ke,{})):s.length?y.jsx(Ie.Gallery,{images:s,onClick:v=>c(v),thumbnailImageComponent:Ee}):N(y.jsx("span",{children:"No hay imágenes para mostrar"})),_=y.jsxs("div",{children:[y.jsx(_e,{value:A,onChange:v=>{W(v),v?T(()=>{f.fetch({search:v},{onAfterSuccess:G})},500):G(null),W(v)}}),y.jsx("p",{className:"mt-3 text-gray-400",children:`(${j?"Seleccione una o varias imágenes":"Seleccione una imagen"})`}),y.jsx("div",{className:"h-[calc(100vh-18rem)] overflow-y-auto",children:U()})]});return y.jsx(We,{title:"Catálogos de imágenes",content:_,badge:y.jsx(we,{variant:"info"}),primaryBtn:y.jsx(Ce,{label:"Seleccionar",onClick:D}),secondaryBtn:y.jsx(je,{})})};export{Be as CatalogsSearchImage};
