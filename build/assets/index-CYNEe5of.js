import{k as M,j as e,I as _,H as h,J as E,n as O,i as g,K as I,r as D,b as G,u as R,g as q,M as H,h as J,F as K,O as d,t as Q,B as T,f as W,w as X,v as Y,P as Z,Q as $,x as ee,y as se,S as te}from"./index-ih0eSx80.js";import{M as ae}from"./index-gmqFlRPh.js";import{F as oe,a as ne}from"./index-jgCKOpGx.js";import{u as re,F as ie}from"./useAddManyImages-wVxDWdmU.js";import{u as le,F as ce,A as de,a as ue}from"./index-LTXxtrN8.js";import{F as z}from"./index-Z1FoIn4o.js";import{u as me}from"./index-b7vcoc-g.js";import{F as pe}from"./index-SWQFTGmj.js";import{u as xe,a as ge}from"./index-PEFSUcyH.js";import"./description-8TzrVJh3.js";import"./radio-group-R5jNLVFN.js";import"./label-5zIu1i7p.js";import"./form-Ycfp73ce.js";import"./index-ezD7gpb8.js";import"./CheckIcon-GmkBleVb.js";const fe=({label:t,...n})=>{var s,i;const{business:a}=M(),r=((i=(s=a==null?void 0:a.layouts)==null?void 0:s.posts)==null?void 0:i.sections)||[],l=me();return e.jsx(z,{label:e.jsxs("div",{className:"flex items-center",children:[t,e.jsx(_,{title:"Agregar nuevo grupo de publicaciones",className:"text-green-600 font-bold ml-2",onClick:o=>{o.preventDefault(),o.stopPropagation(),l.open()}})]}),multi:!0,renderOption:({name:o})=>o,renderValue:({name:o})=>e.jsx("div",{className:"px-2 mx-0.5 rounded-2xl border border-gray-400",children:o}),optionToValue:({id:o})=>o,items:r.map(({_id:o,name:c})=>({id:o,name:c})),...n})},je=({className:t,label:n,collapsable:a,...r})=>{const{field:l,error:s}=h(r),{getFieldName:i}=le({field:l,initialValues:{shoppingMethod:void 0}}),o=e.jsxs("div",{className:"flex flex-col justify-around h-full px-6 gap-2",children:[e.jsx(ce,{label:"Contacto",name:i("shoppingMethod")}),e.jsx(fe,{label:"Grupos de publicaciones similares",name:i("postsSectionsBelowIds"),className:"mt-6"})]});return e.jsx(E,{label:n,error:s,className:O(t),children:a?e.jsx(de,{header:"Abrir",children:o}):o})},he=({label:t,...n})=>{const{field:a}=h(n);return e.jsx(g,{...n,disabled:!I(a.value),label:e.jsxs("div",{className:"flex items-center gap-2",children:[t,e.jsx(pe,{noUseFormik:!0,value:I(a.value),onChange:r=>{a.onChange({target:{name:a.name,value:r.target.checked?0:null}})}})]}),type:"number"})},U=D.forwardRef((t,n)=>{const{className:a,label:r,...l}=t,{field:s,error:i}=h(t);return e.jsx(E,{label:r,error:i,className:a,children:e.jsx("textarea",{ref:n,className:O("block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",{"ring-1 rounded-md ring-red-500 focus:ring-red-500":!!i}),...l,...s})})}),be=()=>{const t=G(),{authData:n}=R(),a=(n==null?void 0:n.user._id)||"<unknow user>";return{addOnePost:{data:t[0],status:t[1],fetch:(r,l={})=>{t[2]({method:"post",url:q({path:"/posts",urlParams:{userId:a}}),data:r},l)},reset:t[3]}}},Fe=({business:t,portal:n,onAfterSuccess:a,post:r})=>{const{routeName:l,postFormFields:s=[]}=t,{addOnePost:i}=be(),{updateOnePost:o}=xe(),{userPlan:c}=H(),{addManyImages:m}=re(),f=J();return e.jsx(K,{initialValues:{name:"",price:0,currency:"CUP",details:"",description:"",colors:[],clothingSizes:[],images:[],postCategoriesTags:[],postPageLayout:void 0,stockAmount:null,...r||{}},enableReinitialize:!0,validate:p=>f(p,[{field:"name",type:"required"}]),onSubmit:()=>{},children:({values:p,isValid:j})=>e.jsxs("form",{children:[e.jsxs(e.Fragment,{children:[e.jsx(g,{name:"name",label:"Nombre del producto"}),e.jsx(d,{})]}),s.includes("description")&&e.jsxs(e.Fragment,{children:[e.jsx(U,{label:"Descripción",name:"description",rows:3,className:"mt-6"}),e.jsx(d,{})]}),s.includes("details")&&e.jsxs(e.Fragment,{children:[e.jsx(U,{id:"post_details",name:"details",label:"Detalles del producto",className:"mt-6",rows:3}),e.jsx(d,{})]}),e.jsxs(e.Fragment,{children:[e.jsx(ie,{label:"Imagen",id:"images",name:"images",className:"mt-6",getImageSrc:Q,multi:!0,max:c==null?void 0:c.maxImagesByPosts}),e.jsx(d,{})]}),e.jsxs(e.Fragment,{children:[e.jsx(ue,{label:"Categorías",name:"postCategoriesTags",className:"mt-6"}),e.jsx(d,{})]}),(s.includes("price")||s.includes("currency")||s.includes("discount")||s.includes("stockAmount"))&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsx(g,{id:"post_price",name:"price",label:"Precio",type:"number",className:"mt-6 w-full"}),e.jsx(z,{items:[{currency:"CUP"},{currency:"MLC"},{currency:"USD"}],renderOption:({currency:u})=>u,renderValue:({currency:u})=>u,optionToValue:({currency:u})=>u,name:"currency",label:"Moneda",className:"mt-6 w-full"}),s.includes("discount")&&e.jsx(g,{id:"post_discount",name:"discount",label:"Descuento",type:"number",className:"mt-6 w-full"}),s.includes("stockAmount")&&e.jsx(he,{id:"post_stockAmount",name:"stockAmount",label:"Disponibilidad",className:"mt-6 w-full"})]}),e.jsx(d,{})]}),s.includes("colors")&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{label:"Colores",name:"colors",className:"mt-6",multi:!0}),e.jsx(d,{})]}),s.includes("clothingSizes")&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{label:"Tallas",name:"clothingSizes",className:"mt-6",multi:!0}),e.jsx(d,{})]}),s.includes("postPageLayout")&&e.jsxs(e.Fragment,{children:[e.jsx(je,{label:"Diseño de la página de la publicación",name:"postPageLayout",className:"w-full"}),e.jsx(d,{})]}),n.getPortal(e.jsx(T,{label:"Guardar",isBusy:i.status.isBusy||o.status.isBusy,disabled:!j,onClick:()=>{const{images:u,currency:b,description:F,name:y,price:N,clothingSizes:P,colors:S,details:v,postCategoriesTags:L,discount:A,postPageLayout:C,stockAmount:k}=p,w=x=>{const{_id:B}=x;m.fetch({images:u,routeName:l,postId:B,userId:x.createdBy},{onAfterSuccess:V=>{o.fetch({postId:B,images:V,currency:b,description:F,name:y,price:N,clothingSizes:P,colors:S,details:v,postCategoriesTags:L,discount:A,postPageLayout:C,stockAmount:k},{onAfterSuccess:a})}})};r?w(r):(()=>{i.fetch({currency:b,description:F,name:y,price:N,clothingSizes:P,colors:S,details:v,routeName:l,images:[],discount:A,postPageLayout:C,stockAmount:k},{onAfterSuccess:x=>{w(x)}})})()},variant:"primary",className:"w-full"}))]})})},Te=({postId:t,callAfarResources:n})=>{const a=W(),{onClose:r}=X(),l=ge(),{onCallAfar:s}=Y(),i=()=>s(n),o=()=>{i(),r()},{getOnePost:c}=Z(),{business:m,onFetch:f,status:p}=M();D.useEffect(()=>{t&&c.fetch({id:t})},[]);const j=()=>c.status.isBusy||p.isBusy?e.jsx("div",{className:"h-40 flex justify-center items-center",children:e.jsx(te,{})}):m?e.jsx(Fe,{business:m,portal:a,onAfterSuccess:o,post:c.data}):e.jsx(e.Fragment,{});return e.jsx(ae,{title:e.jsxs("div",{className:"flex items-center justify-between",children:[t?"Editar publicación":"Nueva publicación",e.jsx(T,{variant:"link",svg:$,label:"Editar campos del formulario",onClick:()=>l.open({onAfterSuccess:()=>{m&&f({routeName:m.routeName})}})})]}),content:j(),badge:e.jsx(ee,{variant:"info"}),primaryBtn:e.jsx("div",{ref:a.ref}),secondaryBtn:e.jsx(se,{})})};export{Te as PostNew};
