import{r as f,v as R,K as A,G as B,j as e,b9 as P,n as _,k as T}from"./index-ih0eSx80.js";import{u as U}from"./useGetAllPosts-__Z8YCdD.js";import{u as G}from"./index-ZCjJ8GOH.js";import{C as I}from"./index-Lp5J4EkY.js";import{S as L,C as M}from"./index-1EFKHw9-.js";import{P as m,u as O}from"./index-b7vcoc-g.js";import{S as h}from"./search-filter-cecALaN7.js";import{U as V}from"./update-something-container-OFi8Bna5.js";const k=({updateKey:c,data:r,findCB:s,changeCB:l})=>{const[n,i]=f.useState(null);return R(c,u=>{if(!n)return;const o=r==null?void 0:r.findIndex(a=>s(a,u));if(A(o)&&o>=0){const a=n[o];i([...B(n,l(a,u),o)])}}),f.useEffect(()=>{i(r)},[JSON.stringify(r)]),{data:n}},H=({business:c,posts:r,layout:s,callAfarResources:l})=>{const{routeName:n,whatsAppPhoneNumber:i}=c,{type:u}=s;return u==="oneRowSlider"?e.jsx(L,{className:"!w-[90vw] !sm:w-[80vw]",slidesPerView:"auto",items:r==null?void 0:r.map((o,a)=>{const{_id:t}=o;return{content:e.jsx(M,{post:o,layout:s.postCardLayout,href:P({routeName:n,postId:t}),whatsAppPhoneNumber:i,callAfarResources:l},a)}})}):e.jsx(I,{className:"mt-8",children:r==null?void 0:r.map((o,a)=>{const{_id:t}=o;return e.jsx(M,{post:o,layout:s.postCardLayout,href:P({routeName:n,postId:t}),whatsAppPhoneNumber:i,callAfarResources:l},a)})})},J=({layout:c,className:r,filters:s,business:l})=>{const{searchLayout:n,postCategoriesTags:i}=c,{postCategories:u}=l,o=u==null?void 0:u.filter(({hidden:t,tag:p})=>!(t||i!=null&&i.length&&!i.includes(p)));if(n==="none")return e.jsx(e.Fragment,{});const a=t=>e.jsx("div",{className:_("mt-8 w-full",r),children:t});return n==="left"?a(e.jsx("div",{className:"flex justify-start",children:e.jsx(h,{onChange:t=>s.onMergeFilters({search:t}),value:s.value.search})})):n==="center"?a(e.jsx("div",{className:"flex justify-center",children:e.jsx(h,{onChange:t=>s.onMergeFilters({search:t}),value:s.value.search})})):n==="right"?a(e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{onChange:t=>s.onMergeFilters({search:t}),value:s.value.search})})):n==="postCategories"?a(e.jsx(m,{postCategories:o,onChange:t=>s.onMergeFilters({postCategoriesTags:t}),value:s.value.postCategoriesTags,debounceDelay:1e3,type:"wrapped"})):n==="postCategoriesScrollable"?a(e.jsx(m,{postCategories:o,onChange:t=>s.onMergeFilters({postCategoriesTags:t}),value:s.value.postCategoriesTags,debounceDelay:1e3,type:"scrollable"})):n==="postCategoriesExcluded"?a(e.jsx(m,{postCategories:o,onChange:t=>s.onMergeFilters({postCategoriesTags:t}),value:s.value.postCategoriesTags,debounceDelay:1e3,excluding:!0,type:"wrapped"})):n==="postCategoriesExcludedScrollable"?a(e.jsx(m,{postCategories:o,onChange:t=>s.onMergeFilters({postCategoriesTags:t}),value:s.value.postCategoriesTags,debounceDelay:1e3,excluding:!0,type:"scrollable"})):e.jsx(e.Fragment,{})},K=({routeName:c,layout:r,className:s,index:l,visibility:n})=>{const{business:i,onFetch:u}=T(),{name:o,hiddenName:a,postCategoriesTags:t,_id:p,showIn:x}=r,{getAllPosts:C}=U(),{owner:j}=T(),v=!(x!=null&&x.includes(n)),b=v&&!j,S=v&&j,D=k({data:C.data,updateKey:"updatePostAmount",findCB:(d,{postId:g})=>d._id===g,changeCB:(d,{stockAmount:g})=>({...d,stockAmount:g})}),N=d=>{var y;const g=(y=d.postCategoriesTags)==null?void 0:y.length;C.fetch({routeNames:[c],postCategoriesTags:t,...d,postCategoriesMethod:g?"every":"some"})},w=G({onChange:d=>N(d)});f.useEffect(()=>{b||N(w.value)},[JSON.stringify(t)]);const F=`post_section_${l}_business_onRefresh`;R(F,()=>u({routeName:c}));const E=O();return b||!i?e.jsx(e.Fragment,{}):e.jsx(V,{title:"Editar este grupo de publicaciones",onClick:()=>{E.open({sectionId:p})},children:e.jsxs("div",{className:_("mt-10 p-4",{"bg-gray-200 rounded-md":S},s),children:[!a&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:o}),S&&e.jsx("span",{className:"text-sm sm:text-lg ml-3 text-yellow-600",children:"(Solo visible para el administrador del negocio)"})]}),e.jsx(J,{layout:r,filters:w,business:i}),e.jsx(H,{layout:r,posts:D.data,business:i,callAfarResources:[F]})]})})},ee=({routeName:c,layouts:r,visibility:s})=>e.jsx("div",{className:"flex flex-col",children:r==null?void 0:r.map((l,n)=>e.jsx(K,{index:n,routeName:c,layout:l,visibility:s},n))});export{ee as P};
